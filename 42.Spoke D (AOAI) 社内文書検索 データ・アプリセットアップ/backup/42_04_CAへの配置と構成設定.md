
5～10 分ほどおいてから実行する

```bash

# 業務システム D チーム／① 初期構築の作業アカウントに切り替え
if ${FLAG_USE_SOD}; then if ${FLAG_USE_SOD_SP}; then TEMP_SP_NAME="sp_spoked_dev"; az login --service-principal --username ${SP_APP_IDS[${TEMP_SP_NAME}]} --password '${SP_PWDS[${TEMP_SP_NAME}]}' --tenant ${PRIMARY_DOMAIN_NAME} --allow-no-subscriptions; else az account clear; az login -u "user_spoked_dev@${PRIMARY_DOMAIN_NAME}" -p "${ADMIN_PASSWORD}"; fi; fi
 
# Spoke D サブスクリプションで作業
az account set -s "${SUBSCRIPTION_ID_SPOKE_D}"

for i in ${VDC_NUMBERS}; do
TEMP_LOCATION_NAME=${LOCATION_NAMES[$i]}
TEMP_LOCATION_PREFIX=${LOCATION_PREFIXS[$i]}

TEMP_RG_NAME="rg-spoked-${TEMP_LOCATION_PREFIX}"
TEMP_CA_NAME="ca-spoked-${TEMP_LOCATION_PREFIX}"
TEMP_ACR_NAME="acrspoked${UNIQUE_SUFFIX}${TEMP_LOCATION_PREFIX}"
TEMP_IMAGE_NAME="${TEMP_ACR_NAME}.azurecr.io/aoai.sample4:latest"

TEMP_STORAGE_NAME="stspoked${UNIQUE_SUFFIX}${TEMP_LOCATION_PREFIX}"
TEMP_COSMOSDB_NAME="cos-spoked-${UNIQUE_SUFFIX}-${TEMP_LOCATION_PREFIX}"
TEMP_SEARCHSERVICE_NAME="src-spoked-${UNIQUE_SUFFIX}-${TEMP_LOCATION_PREFIX}"
TEMP_FORMRECOGNIZER_NAME="fmr-spoked-${UNIQUE_SUFFIX}-${TEMP_LOCATION_PREFIX}"
TEMP_AOAI_NAME="aoai-spoked-${UNIQUE_SUFFIX}-${TEMP_LOCATION_PREFIX}"

TEMP_COSMOSDB_SQLDB_NAME="ChatHistory"
TEMP_COSMOSDB_CONTAINER_NAME="Prompts"
TEMP_AOAI_DAVINCI_DEPLOYMENT_NAME="davinci"
TEMP_AOAI_GPT_35_TURBO_DEPLOYMENT_NAME="chat"
TEMP_AOAI_GPT_4_32K_DEPLOYMENT=''
TEMP_AOAI_GPT_4_DEPLOYMENT=''
TEMP_AOAI_API_VERSION='2023-05-15'

# コンテナをデプロイする（接続文字列は環境変数で設定）
az containerapp update --resource-group "${TEMP_RG_NAME}" --name "${TEMP_CA_NAME}" --image "${TEMP_IMAGE_NAME}" --workload-profile-name "Consumption" --set-env-vars \
"AZURE_STORAGE_ACCOUNT=${TEMP_STORAGE_NAME}" \
"AZURE_STORAGE_CONTAINER=content" \
"AZURE_SEARCH_SERVICE=${TEMP_SEARCHSERVICE_NAME}" \
"AZURE_SEARCH_INDEX=gptkbindex" \
"AZURE_OPENAI_SERVICE=${TEMP_AOAI_NAME}" \
"AZURE_OPENAI_API_VERSION=2023-05-15" \
"AZURE_OPENAI_DAVINCI_DEPLOYMENT=${TEMP_AOAI_DAVINCI_DEPLOYMENT_NAME}" \
"AZURE_OPENAI_GPT_35_TURBO_DEPLOYMENT=${TEMP_AOAI_GPT_35_TURBO_DEPLOYMENT_NAME}" \
"AZURE_OPENAI_GPT_4_DEPLOYMENT=${TEMP_AOAI_GPT_4_DEPLOYMENT}" \
"AZURE_OPENAI_GPT_4_32K_DEPLOYMENT=${TEMP_AOAI_GPT_4_32K_DEPLOYMENT}" \
"AZURE_COSMOSDB_CONTAINER=${TEMP_COSMOSDB_CONTAINER_NAME}" \
"AZURE_COSMOSDB_DATABASE=${TEMP_COSMOSDB_SQLDB_NAME}" \
"AZURE_COSMOSDB_ENDPOINT=https://${TEMP_COSMOSDB_NAME}.documents.azure.com" \
--verbose --cpu 1 --min-replicas 1 --memory 2.0Gi

done # TEMP_LOCATION



```
